<div class="developers-container">
    <h2 class="h2">All Developers</h2>

    <div class="top-bar">

        <input type="text" placeholder="Search developers..." [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange($event)" />
        <select [(ngModel)]="filterCountry" (change)="applyFilters()">
            <option value="" disabled selected>Country</option>
            <option value="all">All Countries</option>
            <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
        </select>

        <select [(ngModel)]="filterAvailability" (change)="applyFilters()">
            <option value="" disabled selected>Availability</option>
            <option value="">All Options</option>
            <option *ngFor="let availability of availabilities" [value]="availability">{{ availability }}</option>
        </select>

        <select [(ngModel)]="filterSkillCategory" (change)="onSkillCategoryChange()">
            <option value="" disabled selected>Categories</option>
            <option value="">All Categories</option>
            <option *ngFor="let cat of availableSkillCategories" [value]="cat">{{ cat }}</option>
        </select>
        <select [(ngModel)]="filterSkillName" (change)="onSkillNameChange()">
            <option value="" disabled selected>Skills</option>
            <option value="">All Skills</option>
            <option *ngFor="let skill of availableSkills" [value]="skill">{{ skill }}</option>
        </select>
        <select [(ngModel)]="filterSkillLevel" (change)="applyFilters()">
            <option value="" disabled selected>Skill Level</option>
            <option value="">All Skill Levels</option>
            <option *ngFor="let level of skillLevels" [value]="level">{{ level }}</option>
        </select>
    </div>

    <table class="developers-table">
        <thead>
            <tr>
                <th (click)="setSort('entries')">#</th>
                <th (click)="setSort('fullName')">Full Name</th>
                <th (click)="setSort('email')">Email</th>
                <th (click)="setSort('country')">Country</th>
                <th (click)="setSort('experienceLevel')">Experience</th>
                <th (click)="setSort('availability')">Availability</th>
                <th>Primary Skills</th>
                <th style="white-space: nowrap;" >Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let user of filteredUsers">
                <td>{{ user.entries }}</td>
                <td>{{ user.fullName }}</td>
                <td>{{ user.email }}</td>
               <td style="white-space: nowrap;">{{ user.country }}</td>

                <td>{{ user.experienceLevel }}</td>
                <td>{{ user.availability }}</td>

<td class="skills-cell">
    <ol class="skills-list">
        <li *ngFor="let skill of user.primarySkills; let i = index" [class.expanded]="expandedUsers.has(user.id)">
            <ng-container *ngIf="i === 0 || expandedUsers.has(user.id)">
                <span class="skill-category">{{ skill.category }}:</span>
                <span class="skill-name">{{ skill.skill }}</span>
                <span class="skill-level-badge" [ngClass]="(skill.level | lowercase)">
                    {{ skill.level }}
                </span>
            </ng-container>
        </li>
    </ol>
    <ng-container *ngIf="user.primarySkills.length > 1">
        <a href="#" (click)="toggleSkills(user, $event)" class="show-more-link">
            {{ expandedUsers.has(user.id) ? 'Show Less' : '+ ' + (user.primarySkills.length - 1) + ' more' }}
        </a>
    </ng-container>
</td>
                <td>
                    <div class="actions-dropdown">
                        <button class="dropdown-toggle" (click)="toggleDropdown(user, $event)">
                            ...
                        </button>

                        <div class="dropdown-menu" *ngIf="expandedDropdowns.has(user.id)">
                            <a class="dropdown-item" (click)="viewUser(user)">View</a>
                            <a class="dropdown-item" (click)="editUser(user)">Edit</a>
                            <a class="dropdown-item" (click)="deleteUser(user)">Delete</a>
                        </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="pagination">
        <button (click)="goToPage(page - 1)" [disabled]="page === 1">Prev</button>
        <span>Page {{ page }} of {{ totalPages }}</span>
        <button (click)="goToPage(page + 1)" [disabled]="page === totalPages">Next</button>
        <select [(ngModel)]="pageSize" (change)="onPageSizeChange(pageSize)">
            <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
        </select>
    </div>

    <div *ngIf="loading" class="loading">Loading...</div>
    <div *ngIf="error" class="error">{{ error }}</div>
</div>